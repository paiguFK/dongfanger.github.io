性能测试 27题
=============

|image1|

**什么是性能平坦区？什么是性能拐点？**

::

   性能平坦区：不断加压，性能没有什么变化。是性能最佳区间。
   性能拐点：性能开始急剧下降的点。

**性能测试结果分析有哪些指标？**

::

   并发数。

   平均响应时间，吞吐量，吞吐率（TPS/QPS）。

   CPU，内存，磁盘IO，网络。

**性能分析**

::

   数据库连接数，Cache命中情况。

   无死锁。

   PV（page view ）：网站用户访问的网页的数量。

   UV （unique visitor ）：访问某个站点或点击某个网页的不同IP地址的人数。

   JVM的GC、Heap。(GC曲线图 ygc耗时，无 Full GC)

**什么是全链路压测？**

::

   基于实际的线上业务场景和真实环境，模拟海量的用户请求和数据对整个业务链进行压力测试。

**QPS和TPS区别？**

::

   QPS，服务器每秒处理查询次数，是一台服务器每秒能够处理的查询次数。用户发起查询请求到服务器做出响应这算一次，一秒内用户完成了50次查询请求，那此时服务器QPS就是50。
   TPS，服务器每秒处理的事务数。在针对单接口的时候TPS == QPS，多接口比如访问 ‘order.html’ 页面可能请求了3次服务器（如调用了css、js、order接口），TPS==1，QPS==3。

**狭义并发和广义并发？**

::

   狭义并发指同一时间点开始做某件事情。
   广义并发指同一时间段正在做某件事情。
   理解：
   1.压测时，会设置集合点，狭义并发。
   2.持续压测一段时间，广义并发。

**一个web系统，用户从打开浏览器输入网址页面到显示在浏览器中，响应时间通常可以细分为哪些？**

::

   浏览器请求时间
   服务器处理时间
   服务器响应时间
   浏览器渲染时间

**SDK性能测试关注点？**

::

   内存、CPU、流量、线程、接口耗时。

**如果发现性能瓶颈，你怎么分析？**

::

   服务器硬件瓶颈
   网络瓶颈（对局域网，可以不考虑）
   服务器操作系统瓶颈（参数配置）
   中间件瓶颈（参数配置，数据库，web服务器等）
   应用瓶颈（SQL语句、数据库设计、业务逻辑、算法等）

**TPS计算公式中的2个T指什么？**

::

   一个T是指Transaction，一个T是指RequestTime+ResponseTime。

**TPS和QPS的区别？**

::

   QPS是TPS的一种。
   T是Transaction，Q是Query。

**TPS与吞吐量区别？**

::

   TPS，每秒通过事务数。
   吞吐量，单位时间内系统能处理的请求数量。

**什么是负载测试？**

::

   负载测试，加大并发，寻找系统性能拐点，并对比线上流量，做容量预估及规划。

**分别说说应用、数据库、中间件的可靠性测试？**

::

   应用可靠性测试：在应用进程被kill后，能够在5分钟内自动拉起，并逐步恢复原有的业务处理能力。
   数据库可靠性测试：例如主数据库出现异常时，备用数据库可以及时的成为主库，保证系统的高可用。
   中间件可靠性测试：例如中间件主服务出现异常时，中间件从服务可以及时的成为主服务，保证系统的高可用。

**容量规划的目的是什么？**

::

   什么时候调整节点
   调整多少节点
   设定限流
   服务降级

**异步消费压测怎么做？**

::

   往队列发送消息。
   等堆积到一定数量后启动消费者服务（压测服务）。
   记录消费速率，观察各项资源使用。

**性能测试过程中对Redis、数据库、业务服务做哪些监控？**

::

   Redis缓存一般监控占用内存值、网络流量。
   数据库监控连接数、磁盘空间。
   业务服务监控并发数、响应延迟、错误率等。

**什么是链路跟踪？**

::

   为了方便定位问题，需要能够记录每个用户请求时，微服务内部产生了多少服务调用，及其调用关系。

**性能测试流程？**

::

   1、需求阶段
       1.1 提交需求
       1.2 性能测试方案和计划
       1.3 性能提测标准
   2、准备阶段
       2.1 环境部署
       2.2 脚本编写和调试
       2.3 数据准备
   3、执行阶段
       3.1 工作汇报
       3.2 压测和监控
   4、报告阶段

**做性能测试前有哪些准备工作？**

::

   压力机检查，硬件配置，负载均衡。
   数据库检查，数据库连接，表空间，表数据量。
   应用检查，参数配置，比如jvm，日志级别，节点是否正常，最大连接数等。
   了解系统架构，了解用户使用场景，数据情况。
   确认测试目标，性能指标。

**1台客户端有300个客户与300个客户端有300个客户对服务器施压，有什么区别？**

::

   1台客户端有300个客户，是对服务器的持续施压，每次只有单个客户的流量。
   300台客户端有300个客户，是对服务器的并发施压，同时有300个客户的流量。

**压测中TPS上不去，那么你怎么分析这个问题？**

::

   网络带宽
   连接池
   垃圾回收
   数据库配置
   通信连接机制
   硬件资源
   压力机
   压测脚本
   业务逻辑
   系统架构

**响应时间和吞吐量直接的关系是什么？**

::

   平均响应时间越短，系统吞吐量越大。平均响应时间越长，系统吞吐量越小。

**有一天早上打车高峰，滴滴服务端挂了大概30分钟，工程师抢修之后，马上上线，之后又挂了，请问有哪些原因会造成这个情况？**

::

   上线后，积压的请求一下又全部打过来，瞬间并发量非常大，超出负载。
   服务器内存不够。
   被恶意攻击。

**压力测试和负载测试的区别？**

::

   负载测试是进行梯度加压，评估系统的性能表现。
   压力测试是在高负载（大数据量、大量并发用户等）下，测试系统的性能极限。

**做性能测试一般遇到哪些类型的性能问题？**

::

   OOM内存不足
   内存泄露
   线程死锁
   锁争用
   堆栈资源不足
   Java进程消耗CPU过高
   文件IO消耗严重
   网络IO消耗严重

   延伸：
   持续地启线程，申请栈资源，造成内存不足。
   不断地申请对象，后面对象申请不到内存资源。
   频繁地触发FULL GC，造成OOM。
   us高：执行线程不需要任何挂起动作，且一直执行，导致CPU 没有机会去调度执行其他的线程。
   sy高：线程的运行状态要经常切换。

**压测的时候cpu高，你怎么分析？**

::

   看进程 top命令
   看线程 top -Hp pid
   分析线程状态 jstack [进程]|grep -A 10 [线程的16进制]，如jstack 12920|grep -A 10 2600

.. |image1| image:: ../wanggang.png
