JUnit5ç¼–å†™åŸºæœ¬æµ‹è¯•
==================

|image1|

JUnit5çš„æµ‹è¯•ä¸æ˜¯é€šè¿‡åç§°ï¼Œè€Œæ˜¯é€šè¿‡æ³¨è§£æ¥æ ‡è¯†çš„ã€‚

æµ‹è¯•ç±»ä¸æ–¹æ³•
------------

**Test Class**\ ï¼šæµ‹è¯•ç±»ï¼Œå¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªtestæ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š

-  æœ€å¤–å±‚çš„class
-  ``static`` member class
-  ``@Nested`` class

**Test Method**\ ï¼šæµ‹è¯•æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š

-  ``@Test``
-  ``@RepeatedTest``
-  ``@ParameterizedTest``
-  ``@TestFactory``
-  ``@TestTemplate``

**Lifecycle Method**\ ï¼šç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š

-  ``@BeforeAll``
-  ``@AfterAll``
-  ``@BeforeEach``
-  ``@AfterEach``

æ³¨æ„ï¼š

1. Test Methodå’ŒLifecycle
   Methodä¸èƒ½æ˜¯\ ``abstract``\ ï¼Œ\ **ä¹Ÿä¸èƒ½return**\ ã€‚å®ƒä»¬å¯ä»¥åœ¨å½“å‰æµ‹è¯•ç±»ä¸­å£°æ˜ï¼Œä¹Ÿå¯ä»¥ç»§æ‰¿è‡ªçˆ¶ç±»æˆ–æ¥å£ã€‚
2. Test classã€Test Methodå’ŒLifecycle Methodéƒ½ä¸èƒ½æ˜¯privateã€‚

ç¤ºä¾‹ä»£ç ï¼š

.. code:: java

   import static org.junit.jupiter.api.Assertions.fail;
   import static org.junit.jupiter.api.Assumptions.assumeTrue;

   import org.junit.jupiter.api.AfterAll;
   import org.junit.jupiter.api.AfterEach;
   import org.junit.jupiter.api.BeforeAll;
   import org.junit.jupiter.api.BeforeEach;
   import org.junit.jupiter.api.Disabled;
   import org.junit.jupiter.api.Test;

   class StandardTests {

       @BeforeAll
       static void initAll() {
       }

       @BeforeEach
       void init() {
       }

       @Test
       void succeedingTest() {
       }

       @Test
       void failingTest() {
           fail("a failing test");
       }

       @Test
       @Disabled("for demonstration purposes")
       void skippedTest() {
           // not executed
       }

       @Test
       void abortedTest() {
           assumeTrue("abc".contains("Z"));
           fail("test should have been aborted");
       }

       @AfterEach
       void tearDown() {
       }

       @AfterAll
       static void tearDownAll() {
       }

   }

è‡ªå®šä¹‰æ˜¾ç¤ºåå­—
--------------

Test classå’Œtest
methodå¯ä»¥ä½¿ç”¨\ ``@DisplayName``\ è‡ªå®šä¹‰åœ¨æµ‹è¯•æŠ¥å‘Šä¸­çš„æ˜¾ç¤ºåå­—ï¼Œæ”¯æŒç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦å’Œemojiè¡¨æƒ…ç¬¦å·ã€‚

ç¤ºä¾‹ï¼š

.. code:: java

   import org.junit.jupiter.api.DisplayName;
   import org.junit.jupiter.api.Test;

   @DisplayName("A special test case")
   class DisplayNameDemo {

       @Test
       @DisplayName("Custom test name containing spaces")
       void testWithDisplayNameContainingSpaces() {
       }

       @Test
       @DisplayName("â•¯Â°â–¡Â°ï¼‰â•¯")
       void testWithDisplayNameContainingSpecialCharacters() {
       }

       @Test
       @DisplayName("ğŸ˜±")
       void testWithDisplayNameContainingEmoji() {
       }

   }

é™¤äº†\ ``@DisplayName``\ ï¼Œ\ ``@DisplayNameGeneration``\ æ³¨è§£èƒ½ç”¨æ¥å¯¹æ˜¾ç¤ºåå­—åšç»Ÿä¸€å¤„ç†ï¼ŒJUnit
Jupiterè‡ªå¸¦äº†ä¸€äº›ç”Ÿæˆå™¨ï¼š

-  Standard åŒ¹é…æ ‡å‡†è¡Œä¸º
-  Simple åˆ é™¤æ²¡æœ‰å‚æ•°çš„æ–¹æ³•åé¢çš„æ‹¬å·
-  ReplaceUnderscores ç”¨ç©ºæ ¼æ›¿æ¢ä¸‹åˆ’çº¿
-  IndicativeSentences æŠŠtest classå’Œtest methodåå­—è¿æ¥èµ·æ¥

ç¤ºä¾‹ä»£ç ï¼š

.. code:: java

   import org.junit.jupiter.api.DisplayName;
   import org.junit.jupiter.api.DisplayNameGeneration;
   import org.junit.jupiter.api.DisplayNameGenerator;
   import org.junit.jupiter.api.IndicativeSentencesGeneration;
   import org.junit.jupiter.api.Nested;
   import org.junit.jupiter.api.Test;
   import org.junit.jupiter.params.ParameterizedTest;
   import org.junit.jupiter.params.provider.ValueSource;

   class DisplayNameGeneratorDemo {

       @Nested
       @DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)
       class A_year_is_not_supported {

           @Test
           void if_it_is_zero() {
           }

           @DisplayName("A negative value for year is not supported by the leap year computation.")
           @ParameterizedTest(name = "For example, year {0} is not supported.")
           @ValueSource(ints = { -1, -4 })
           void if_it_is_negative(int year) {
           }

       }

       @Nested
       @IndicativeSentencesGeneration(separator = " -> ", generator = DisplayNameGenerator.ReplaceUnderscores.class)
       class A_year_is_a_leap_year {

           @Test
           void if_it_is_divisible_by_4_but_not_by_100() {
           }

           @ParameterizedTest(name = "Year {0} is a leap year.")
           @ValueSource(ints = { 2016, 2020, 2048 })
           void if_it_is_one_of_the_following_years(int year) {
           }

       }

   }

..

   ``@IndicativeSentencesGeneration``\ å¯ä»¥è‡ªå®šä¹‰separatorå’Œgeneratorã€‚

ç»“æœï¼š

::

   +-- DisplayNameGeneratorDemo [OK]
     +-- A year is not supported [OK]
     | +-- A negative value for year is not supported by the leap year computation. [OK]
     | | +-- For example, year -1 is not supported. [OK]
     | | '-- For example, year -4 is not supported. [OK]
     | '-- if it is zero() [OK]
     '-- A year is a leap year [OK]
       +-- A year is a leap year -> if it is divisible by 4 but not by 100. [OK]
       '-- A year is a leap year -> if it is one of the following years. [OK]
         +-- Year 2016 is a leap year. [OK]
         +-- Year 2020 is a leap year. [OK]
         '-- Year 2048 is a leap year. [OK]

é™¤äº†æ³¨è§£ï¼Œä¹Ÿèƒ½é€šè¿‡é…ç½®è®¾å®šå…¨å±€çš„é»˜è®¤Generatorï¼Œæ¯”å¦‚åœ¨\ ``src/test/resources/junit-platform.properties``\ æ–‡ä»¶ä¸­ï¼š

::

   junit.jupiter.displayname.generator.default = \
       org.junit.jupiter.api.DisplayNameGenerator$ReplaceUnderscores

æ—¢å¯ä»¥æŒ‡å®šç°æœ‰Generatorï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®ç°äº†DisplayNameGeneratoræ¥å£çš„ç±»ã€‚

è‡ªå®šä¹‰æ˜¾ç¤ºåå­—çš„ä¼˜å…ˆçº§æ˜¯ï¼š

1. ``@DisplayName``
2. ``@DisplayNameGeneration``
3. ``junit.jupiter.displayname.generator.default``
4. ``org.junit.jupiter.api.DisplayNameGenerator.Standard``

æ–­è¨€ï¼ˆAssertionsï¼‰
------------------

JUnit5çš„æ–­è¨€æ˜¯åŒ…å«åœ¨\ ``org.junit.jupiter.api.Assertions``\ ä¸­çš„é™æ€æ–¹æ³•ï¼Œæ¯”å¦‚assertTrueã€assertEqualsã€assertNotNullã€assertAllã€assertThrowsã€assertTimeoutã€assertTimeoutPreemptivelyç­‰ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code:: java

   import static java.time.Duration.ofMillis;
   import static java.time.Duration.ofMinutes;
   import static org.junit.jupiter.api.Assertions.assertAll;
   import static org.junit.jupiter.api.Assertions.assertEquals;
   import static org.junit.jupiter.api.Assertions.assertNotNull;
   import static org.junit.jupiter.api.Assertions.assertThrows;
   import static org.junit.jupiter.api.Assertions.assertTimeout;
   import static org.junit.jupiter.api.Assertions.assertTimeoutPreemptively;
   import static org.junit.jupiter.api.Assertions.assertTrue;

   import java.util.concurrent.CountDownLatch;

   import example.domain.Person;
   import example.util.Calculator;

   import org.junit.jupiter.api.Test;

   class AssertionsDemo {

       private final Calculator calculator = new Calculator();

       private final Person person = new Person("Jane", "Doe");

       @Test
       void standardAssertions() {
           assertEquals(2, calculator.add(1, 1));
           assertEquals(4, calculator.multiply(2, 2),
                   "The optional failure message is now the last parameter");
           assertTrue('a' < 'b', () -> "Assertion messages can be lazily evaluated -- "
                   + "to avoid constructing complex messages unnecessarily.");
       }

       @Test
       void groupedAssertions() {
           // In a grouped assertion all assertions are executed, and all
           // failures will be reported together.
           assertAll("person",
               () -> assertEquals("Jane", person.getFirstName()),
               () -> assertEquals("Doe", person.getLastName())
           );
       }

       @Test
       void dependentAssertions() {
           // Within a code block, if an assertion fails the
           // subsequent code in the same block will be skipped.
           assertAll("properties",
               () -> {
                   String firstName = person.getFirstName();
                   assertNotNull(firstName);

                   // Executed only if the previous assertion is valid.
                   assertAll("first name",
                       () -> assertTrue(firstName.startsWith("J")),
                       () -> assertTrue(firstName.endsWith("e"))
                   );
               },
               () -> {
                   // Grouped assertion, so processed independently
                   // of results of first name assertions.
                   String lastName = person.getLastName();
                   assertNotNull(lastName);

                   // Executed only if the previous assertion is valid.
                   assertAll("last name",
                       () -> assertTrue(lastName.startsWith("D")),
                       () -> assertTrue(lastName.endsWith("e"))
                   );
               }
           );
       }

       @Test
       void exceptionTesting() {
           Exception exception = assertThrows(ArithmeticException.class, () ->
               calculator.divide(1, 0));
           assertEquals("/ by zero", exception.getMessage());
       }

       @Test
       void timeoutNotExceeded() {
           // The following assertion succeeds.
           assertTimeout(ofMinutes(2), () -> {
               // Perform task that takes less than 2 minutes.
           });
       }

       @Test
       void timeoutNotExceededWithResult() {
           // The following assertion succeeds, and returns the supplied object.
           String actualResult = assertTimeout(ofMinutes(2), () -> {
               return "a result";
           });
           assertEquals("a result", actualResult);
       }

       @Test
       void timeoutNotExceededWithMethod() {
           // The following assertion invokes a method reference and returns an object.
           String actualGreeting = assertTimeout(ofMinutes(2), AssertionsDemo::greeting);
           assertEquals("Hello, World!", actualGreeting);
       }

       @Test
       void timeoutExceeded() {
           // The following assertion fails with an error message similar to:
           // execution exceeded timeout of 10 ms by 91 ms
           assertTimeout(ofMillis(10), () -> {
               // Simulate task that takes more than 10 ms.
               Thread.sleep(100);
           });
       }

       @Test
       void timeoutExceededWithPreemptiveTermination() {
           // The following assertion fails with an error message similar to:
           // execution timed out after 10 ms
           assertTimeoutPreemptively(ofMillis(10), () -> {
               // Simulate task that takes more than 10 ms.
               new CountDownLatch(1).await();
           });
       }

       private static String greeting() {
           return "Hello, World!";
       }

   }

å‡è®¾ï¼ˆAssumptionsï¼‰
-------------------

JUnit5çš„æ–­è¨€æ˜¯åŒ…å«åœ¨\ ``org.junit.jupiter.api.Assumptions``\ ä¸­çš„é™æ€æ–¹æ³•ï¼Œæ¯”å¦‚assumeTrueã€assumingThatç­‰ã€‚

ç¤ºä¾‹ä»£ç ï¼š

.. code:: java

   import static org.junit.jupiter.api.Assertions.assertEquals;
   import static org.junit.jupiter.api.Assumptions.assumeTrue;
   import static org.junit.jupiter.api.Assumptions.assumingThat;

   import example.util.Calculator;

   import org.junit.jupiter.api.Test;

   class AssumptionsDemo {

       private final Calculator calculator = new Calculator();

       @Test
       void testOnlyOnCiServer() {
           assumeTrue("CI".equals(System.getenv("ENV")));
           // remainder of test
       }

       @Test
       void testOnlyOnDeveloperWorkstation() {
           assumeTrue("DEV".equals(System.getenv("ENV")),
               () -> "Aborting test: not on developer workstation");
           // remainder of test
       }

       @Test
       void testInAllEnvironments() {
           assumingThat("CI".equals(System.getenv("ENV")),
               () -> {
                   // perform these assertions only on the CI server
                   assertEquals(2, calculator.divide(4, 2));
               });

           // perform these assertions in all environments
           assertEquals(42, calculator.multiply(6, 7));
       }

   }

Assertionsä¸AssumptionsåŒºåˆ«
---------------------------

Assertionså¦‚æœå¤±è´¥ï¼Œtestä¼šè¢«æ ‡è®°ä¸ºfailedã€‚Assumptionså¦‚æœå¤±è´¥ï¼Œtestä¼šè¢«æ ‡è®°ä¸ºignoredï¼Œ\ **æµ‹è¯•ä¸ä¼šæ‰§è¡Œ**\ ã€‚

ç¤ºä¾‹ï¼š

.. code:: java

   import org.junit.jupiter.api.Test;

   import static org.junit.jupiter.api.Assertions.assertTrue;
   import static org.junit.jupiter.api.Assumptions.assumeTrue;

   public class Demo {
       @Test
       void assertTest() {
           assertTrue(false);
       }

       @Test
       void assumeTest() {
           assumeTrue(false);
       }
   }

ç»“æœï¼š

|image2|

ç¦ç”¨æµ‹è¯•
--------

``@Disabled``\ èƒ½ç”¨æ¥ç¦ç”¨test classæˆ–test
methodï¼Œå»ºè®®åœ¨æ‹¬å·å†…å¡«å†™ä¸Šç¦ç”¨ç†ç”±ã€‚

ç¤ºä¾‹ï¼š

.. code:: java

   import org.junit.jupiter.api.Disabled;
   import org.junit.jupiter.api.Test;

   @Disabled("Disabled until bug #99 has been fixed")
   class DisabledClassDemo {

       @Test
       void testWillBeSkipped() {
       }

   }

.. code:: java

   import org.junit.jupiter.api.Disabled;
   import org.junit.jupiter.api.Test;

   class DisabledTestsDemo {

       @Disabled("Disabled until bug #42 has been resolved")
       @Test
       void testWillBeSkipped() {
       }

       @Test
       void testWillBeExecuted() {
       }

   }

å°ç»“
----

æœ¬æ–‡é¦–å…ˆä»‹ç»äº†å¦‚ä½•ä½¿ç”¨æµ‹è¯•ç±»ä¸æ–¹æ³•ï¼Œæ¥ç¼–å†™ä¸€ä¸ªJUnit5çš„åŸºæœ¬æµ‹è¯•ï¼Œç„¶åä»‹ç»äº†å¦‚ä½•è‡ªå®šä¹‰æµ‹è¯•æŠ¥å‘Šä¸­çš„æ˜¾ç¤ºåå­—ã€‚ä½¿ç”¨æ–­è¨€ï¼ˆAssertionsï¼‰å¯ä»¥æŠŠtestæ ‡è®°ä¸ºfailedï¼Œä½¿ç”¨å‡è®¾ï¼ˆAssumptionsï¼‰å¯ä»¥æŠŠtestæ ‡è®°ä¸ºignoredã€‚æœ€åä»‹ç»äº†å¦‚ä½•ç¦ç”¨æµ‹è¯•ã€‚é™¤äº†åŸºæœ¬æµ‹è¯•ï¼ŒJUnit5è¿˜èƒ½ç¼–å†™å¸¦æ¡ä»¶çš„æµ‹è¯•ã€‚

   å‚è€ƒèµ„æ–™ï¼š

   https://junit.org/junit5/docs/current/user-guide/#writing-tests

   https://stackoverflow.com/questions/44628483/assume-vs-assert-in-junit-tests

.. |image1| image:: ../wanggang.png
.. |image2| image:: 003-JUnit5ç¼–å†™åŸºæœ¬æµ‹è¯•/image-20210707162457398.png
