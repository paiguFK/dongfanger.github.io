2 JUnit5æ³¨è§£å­¦ä¹ æŒ‡å¼•
====================

|image1|

æ³¨è§£ï¼ˆAnnotationsï¼‰æ˜¯JUnitçš„æ ‡å¿—æ€§æŠ€æœ¯ï¼Œæœ¬æ–‡å°±æ¥å¯¹å®ƒçš„20ä¸ªæ³¨è§£ï¼Œä»¥åŠå…ƒæ³¨è§£å’Œç»„åˆæ³¨è§£è¿›è¡Œå­¦ä¹ ã€‚

20ä¸ªæ³¨è§£
--------

åœ¨\ ``org.junit.jupiter.api``\ åŒ…ä¸­å®šä¹‰äº†è¿™äº›æ³¨è§£ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š

-  ``@Test`` æµ‹è¯•æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚

-  ``@ParameterizedTest`` å‚æ•°åŒ–æµ‹è¯•ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      @ParameterizedTest
      @ValueSource(strings = { "racecar", "radar", "able was I ere I saw elba" })
      void palindromes(String candidate) {
          assertTrue(StringUtils.isPalindrome(candidate));
      }

-  ``@RepeatedTest`` é‡å¤æµ‹è¯•ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      @RepeatedTest(10)
      void repeatedTest() {
          // ...
      }

-  ``@TestFactory`` æµ‹è¯•å·¥å‚ï¼Œä¸“é—¨ç”Ÿæˆæµ‹è¯•æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      import org.junit.jupiter.api.DynamicTest;

      @TestFactory
      Collection<DynamicTest> dynamicTestsFromCollection() {
          return Arrays.asList(
              dynamicTest("1st dynamic test", () -> assertTrue(isPalindrome("madam"))),
              dynamicTest("2nd dynamic test", () -> assertEquals(4, calculator.multiply(2, 2)))
          );
      }

-  ``@TestTemplate`` æµ‹è¯•æ¨¡æ¿ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      final List<String> fruits = Arrays.asList("apple", "banana", "lemon");

      @TestTemplate
      @ExtendWith(MyTestTemplateInvocationContextProvider.class)
      void testTemplate(String fruit) {
          assertTrue(fruits.contains(fruit));
      }

      public class MyTestTemplateInvocationContextProvider
              implements TestTemplateInvocationContextProvider {

          @Override
          public boolean supportsTestTemplate(ExtensionContext context) {
              return true;
          }

          @Override
          public Stream<TestTemplateInvocationContext> provideTestTemplateInvocationContexts(
                  ExtensionContext context) {

              return Stream.of(invocationContext("apple"), invocationContext("banana"));
          }
      }

   ..

      @TestTemplateå¿…é¡»æ³¨å†Œä¸€ä¸ªTestTemplateInvocationContextProviderï¼Œå®ƒçš„ç”¨æ³•è·Ÿ@Testç±»ä¼¼ã€‚

-  ``@TestMethodOrder`` æŒ‡å®šæµ‹è¯•é¡ºåºï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      import org.junit.jupiter.api.MethodOrderer.OrderAnnotation;
      import org.junit.jupiter.api.Order;
      import org.junit.jupiter.api.Test;
      import org.junit.jupiter.api.TestMethodOrder;

      @TestMethodOrder(OrderAnnotation.class)
      class OrderedTestsDemo {

          @Test
          @Order(1)
          void nullValues() {
              // perform assertions against null values
          }

          @Test
          @Order(2)
          void emptyValues() {
              // perform assertions against empty values
          }

          @Test
          @Order(3)
          void validValues() {
              // perform assertions against valid values
          }

      }

-  ``@TestInstance``
   æ˜¯å¦ç”Ÿæˆå¤šä¸ªæµ‹è¯•å®ä¾‹ï¼Œé»˜è®¤JUnitæ¯ä¸ªæµ‹è¯•æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œä½¿ç”¨è¿™ä¸ªæ³¨è§£èƒ½\ **è®©æ¯ä¸ªç±»åªç”Ÿæˆä¸€ä¸ªå®ä¾‹**\ ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      @TestInstance(Lifecycle.PER_CLASS)
      class TestMethodDemo {

          @Test
          void test1() {
          }

          @Test
          void test2() {
          }

          @Test
          void test3() {
          }

      }

-  ``@DisplayName`` è‡ªå®šä¹‰æµ‹è¯•åå­—ï¼Œä¼šä½“ç°åœ¨æµ‹è¯•æŠ¥å‘Šä¸­ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      import org.junit.jupiter.api.DisplayName;
      import org.junit.jupiter.api.Test;

      @DisplayName("A special test case")
      class DisplayNameDemo {

          @Test
          @DisplayName("Custom test name containing spaces")
          void testWithDisplayNameContainingSpaces() {
          }

          @Test
          @DisplayName("â•¯Â°â–¡Â°ï¼‰â•¯")
          void testWithDisplayNameContainingSpecialCharacters() {
          }

          @Test
          @DisplayName("ğŸ˜±")
          void testWithDisplayNameContainingEmoji() {
          }

      }

-  ``@DisplayNameGeneration`` æµ‹è¯•åå­—ç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      import org.junit.jupiter.api.DisplayName;
      import org.junit.jupiter.api.DisplayNameGeneration;
      import org.junit.jupiter.api.DisplayNameGenerator;
      import org.junit.jupiter.api.IndicativeSentencesGeneration;
      import org.junit.jupiter.api.Nested;
      import org.junit.jupiter.api.Test;
      import org.junit.jupiter.params.ParameterizedTest;
      import org.junit.jupiter.params.provider.ValueSource;

      class DisplayNameGeneratorDemo {

          @Nested
          @DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)
          class A_year_is_not_supported {

              @Test
              void if_it_is_zero() {
              }

              @DisplayName("A negative value for year is not supported by the leap year computation.")
              @ParameterizedTest(name = "For example, year {0} is not supported.")
              @ValueSource(ints = { -1, -4 })
              void if_it_is_negative(int year) {
              }

          }

          @Nested
          @IndicativeSentencesGeneration(separator = " -> ", generator = DisplayNameGenerator.ReplaceUnderscores.class)
          class A_year_is_a_leap_year {

              @Test
              void if_it_is_divisible_by_4_but_not_by_100() {
              }

              @ParameterizedTest(name = "Year {0} is a leap year.")
              @ValueSource(ints = { 2016, 2020, 2048 })
              void if_it_is_one_of_the_following_years(int year) {
              }

          }

      }

-  ``@BeforeEach`` åœ¨æ¯ä¸ª\ ``@Test``, ``@RepeatedTest``,
   ``@ParameterizedTest``, or ``@TestFactory``\ ä¹‹å‰æ‰§è¡Œã€‚

-  ``@AfterEach`` åœ¨æ¯ä¸ª\ ``@Test``, ``@RepeatedTest``,
   ``@ParameterizedTest``, or ``@TestFactory``\ ä¹‹åæ‰§è¡Œã€‚

-  ``@BeforeAll`` åœ¨\ **æ‰€æœ‰çš„**\ ``@Test``, ``@RepeatedTest``,
   ``@ParameterizedTest``, **and** ``@TestFactory``\ ä¹‹å‰æ‰§è¡Œã€‚

-  ``@AfterAll`` åœ¨\ **æ‰€æœ‰çš„**\ ``@Test``, ``@RepeatedTest``,
   ``@ParameterizedTest``, **and** ``@TestFactory``\ ä¹‹åæ‰§è¡Œã€‚

-  ``@Nested`` åµŒå¥—æµ‹è¯•ï¼Œä¸€ä¸ªç±»å¥—ä¸€ä¸ªç±»ï¼Œä¾‹å­å‚è€ƒä¸Šé¢é‚£ä¸ªã€‚

-  ``@Tag`` æ‰“æ ‡ç­¾ï¼Œç›¸å½“äºåˆ†ç»„ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      import org.junit.jupiter.api.Tag;
      import org.junit.jupiter.api.Test;

      @Tag("fast")
      @Tag("model")
      class TaggingDemo {

          @Test
          @Tag("taxes")
          void testingTaxCalculation() {
          }

      }

-  ``@Disabled`` ç¦ç”¨æµ‹è¯•ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      import org.junit.jupiter.api.Disabled;
      import org.junit.jupiter.api.Test;

      @Disabled("Disabled until bug #99 has been fixed")
      class DisabledClassDemo {

          @Test
          void testWillBeSkipped() {
          }

      }

-  ``@Timeout`` å¯¹äºtest, test factory, test template, or lifecycle
   methodï¼Œå¦‚æœè¶…æ—¶äº†å°±è®¤ä¸ºå¤±è´¥äº†ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      class TimeoutDemo {

          @BeforeEach
          @Timeout(5)
          void setUp() {
              // fails if execution time exceeds 5 seconds
          }

          @Test
          @Timeout(value = 100, unit = TimeUnit.MILLISECONDS)
          void failsIfExecutionTimeExceeds100Milliseconds() {
              // fails if execution time exceeds 100 milliseconds
          }

      }

-  ``@ExtendWith`` æ³¨å†Œæ‰©å±•ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      @ExtendWith(RandomParametersExtension.class)
      @Test
      void test(@Random int i) {
          // ...
      }

   ..

      JUnit5æä¾›äº†æ ‡å‡†çš„æ‰©å±•æœºåˆ¶æ¥å…è®¸å¼€å‘äººå‘˜å¯¹JUnit5çš„åŠŸèƒ½è¿›è¡Œå¢å¼ºã€‚JUnit5æä¾›äº†å¾ˆå¤šçš„æ ‡å‡†æ‰©å±•æ¥å£ï¼Œç¬¬ä¸‰æ–¹å¯ä»¥ç›´æ¥å®ç°è¿™äº›æ¥å£æ¥æä¾›è‡ªå®šä¹‰çš„è¡Œä¸ºã€‚

-  ``@RegisterExtension`` é€šè¿‡å­—æ®µæ³¨å†Œæ‰©å±•ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      class WebServerDemo {

          @RegisterExtension
          static WebServerExtension server = WebServerExtension.builder()
              .enableSecurity(false)
              .build();

          @Test
          void getProductList() {
              WebClient webClient = new WebClient();
              String serverUrl = server.getServerUrl();
              // Use WebClient to connect to web server using serverUrl and verify response
              assertEquals(200, webClient.get(serverUrl + "/products").getResponseStatus());
          }

      }

-  ``@TempDir`` ä¸´æ—¶ç›®å½•ï¼Œæ¯”å¦‚ï¼š

   .. code:: java

      @Test
      void writeItemsToFile(@TempDir Path tempDir) throws IOException {
          Path file = tempDir.resolve("test.txt");

          new ListWriter(file).write("a", "b", "c");

          assertEquals(singletonList("a,b,c"), Files.readAllLines(file));
      }

å…ƒæ³¨è§£å’Œç»„åˆæ³¨è§£
----------------

JUnit Jupiteræ”¯æŒå…ƒæ³¨è§£ï¼Œèƒ½ç»§æ‰¿åå®ç°è‡ªå®šä¹‰æ³¨è§£ï¼Œæ¯”å¦‚è‡ªå®šä¹‰@Fastæ³¨è§£ï¼š

.. code:: java

   import java.lang.annotation.ElementType;
   import java.lang.annotation.Retention;
   import java.lang.annotation.RetentionPolicy;
   import java.lang.annotation.Target;

   import org.junit.jupiter.api.Tag;

   @Target({ ElementType.TYPE, ElementType.METHOD })
   @Retention(RetentionPolicy.RUNTIME)
   @Tag("fast")
   public @interface Fast {
   }

ä½¿ç”¨ï¼š

.. code:: java

   @Fast
   @Test
   void myFastTest() {
       // ...
   }

è¿™ä¸ª@Fastæ³¨è§£ä¹Ÿæ˜¯ç»„åˆæ³¨è§£ï¼Œç”šè‡³å¯ä»¥æ›´è¿›ä¸€æ­¥å’Œ@Testç»„åˆï¼š

.. code:: java

   import java.lang.annotation.ElementType;
   import java.lang.annotation.Retention;
   import java.lang.annotation.RetentionPolicy;
   import java.lang.annotation.Target;

   import org.junit.jupiter.api.Tag;
   import org.junit.jupiter.api.Test;

   @Target(ElementType.METHOD)
   @Retention(RetentionPolicy.RUNTIME)
   @Tag("fast")
   @Test
   public @interface FastTest {
   }

åªç”¨@FastTestå°±å¯ä»¥äº†ï¼š

.. code:: java

   @FastTest
   void myFastTest() {
       // ...
   }

å°ç»“
----

æœ¬æ–‡å¯¹JUnit20ä¸ªä¸»è¦çš„æ³¨è§£è¿›è¡Œäº†ä»‹ç»å’Œç¤ºä¾‹æ¼”ç¤ºï¼ŒJUnit
Jupiteræ”¯æŒå…ƒæ³¨è§£ï¼Œå¯ä»¥è‡ªå®šä¹‰æ³¨è§£ï¼Œä¹Ÿå¯ä»¥æŠŠå¤šä¸ªæ³¨è§£ç»„åˆèµ·æ¥ã€‚

   å‚è€ƒèµ„æ–™ï¼š

   https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations

   https://vitzhou.gitbooks.io/junit5/content/junit/extension_model.html#%E6%A6%82%E8%BF%B0

.. |image1| image:: ../wanggang.png
