

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6 DRF使用超链接API实现真正RESTful &mdash; dongfanger latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/readmore.js"></script>
        <script src="../_static/js/baidutongji.js"></script>
        <script src="../_static/js/valine.js"></script>
        <script src="../_static/js/Valine.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7 DRF终极封装ViewSet和Router附教程PDF源码" href="007-DRF%E7%BB%88%E6%9E%81%E5%B0%81%E8%A3%85ViewSet%E5%92%8CRouter%E9%99%84%E6%95%99%E7%A8%8BPDF%E6%BA%90%E7%A0%81.html" />
    <link rel="prev" title="5 DRF比Django的认证和权限高在哪里" href="005-DRF%E6%AF%94Django%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%9D%83%E9%99%90%E9%AB%98%E5%9C%A8%E5%93%AA%E9%87%8C.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> dongfanger
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preface.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Java%20Basic.html">Java Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/JMeter.html">JMeter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/JUnit.html">JUnit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Mockito.html">Mockito</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Spring%20Boot.html">Spring Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Maven.html">Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/MyBatis.html">MyBatis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Message%20Queue.html">Message Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Nginx.html">Nginx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/DevOps.html">DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Juice.html">Juice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Python%20Basic.html">Python Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Python%20Advance.html">Python Advance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/pytest.html">pytest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/tep.html">tep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/teprunner.html">teprunner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Django.html">Django</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../chapters/Django%20REST%20framework.html">Django REST framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="001-%E5%BF%AB%E7%94%A8DjangoRESTframework%E5%86%99%E5%86%99API%E5%90%A7.html">1 快用DjangoRESTframework写写API吧</a></li>
<li class="toctree-l2"><a class="reference internal" href="002-%E6%8F%AD%E5%BC%80DRF%E5%BA%8F%E5%88%97%E5%8C%96%E6%8A%80%E6%9C%AF%E7%9A%84%E7%A5%9E%E7%A7%98%E9%9D%A2%E7%BA%B1.html">2 揭开DRF序列化技术的神秘面纱</a></li>
<li class="toctree-l2"><a class="reference internal" href="003-DRF%E5%AF%B9Django%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%81%9A%E4%BA%86%E6%8A%80%E6%9C%AF%E5%8D%87%E7%BA%A7.html">3 DRF对Django请求响应做了技术升级</a></li>
<li class="toctree-l2"><a class="reference internal" href="004-DRF%E7%B1%BB%E8%A7%86%E5%9B%BE%E8%AE%A9%E4%BD%A0%E7%9A%84%E4%BB%A3%E7%A0%81DRY%E8%B5%B7%E6%9D%A5.html">4 DRF类视图让你的代码DRY起来</a></li>
<li class="toctree-l2"><a class="reference internal" href="005-DRF%E6%AF%94Django%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%9D%83%E9%99%90%E9%AB%98%E5%9C%A8%E5%93%AA%E9%87%8C.html">5 DRF比Django的认证和权限高在哪里</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6 DRF使用超链接API实现真正RESTful</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hypermedia-api">超链接（Hypermedia）API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-rootendpoint">创建api_root的Endpoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#snippethighlightendpoint">创建SnippetHighlight的Endpoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hyperlinkedmodelserializer">HyperlinkedModelSerializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#url-pattern">修改url pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">添加分页</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">小结</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="007-DRF%E7%BB%88%E6%9E%81%E5%B0%81%E8%A3%85ViewSet%E5%92%8CRouter%E9%99%84%E6%95%99%E7%A8%8BPDF%E6%BA%90%E7%A0%81.html">7 DRF终极封装ViewSet和Router附教程PDF源码</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Flask.html">Flask</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Locust.html">Locust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Single%20Article.html">Single Article</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Annual%20Summary.html">Annual Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Bildungsroman.html">Bildungsroman</a></li>
<li class="toctree-l1"><a class="reference internal" href="../video.html">Video</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutme.html">About Me</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../link.html">Link</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">dongfanger</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../chapters/Django%20REST%20framework.html">Django REST framework</a> &raquo;</li>
        
      <li>6 DRF使用超链接API实现真正RESTful</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Django REST framework/006-DRF使用超链接API实现真正RESTful.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="drfapirestful">
<h1>6 DRF使用超链接API实现真正RESTful<a class="headerlink" href="#drfapirestful" title="Permalink to this headline">¶</a></h1>
<p><img alt="image1" src="../_images/wanggang2.png" /></p>
<p>很多API并不是真正的实现了RESTful，而应该叫做RPC (Remote Procedure Call
远程过程调用)，Roy Fielding曾经提到了它们的区别，原文如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>I am getting frustrated by the number of people calling any HTTP-based interface a REST API. Today’s example is the SocialSite REST API. That is RPC. It screams RPC. There is so much coupling on display that it should be given an X rating.

What needs to be done to make the REST architectural style clear on the notion that hypertext is a constraint? In other words, if the engine of application state (and hence the API) is not being driven by hypertext, then it cannot be RESTful and cannot be a REST API. Period. Is there some broken manual somewhere that needs to be fixed?

— Roy Fielding
https://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven
</pre></div>
</div>
<p>大概意思是，如果应用状态引擎（API）不是超文本驱动的，那么就不是RESTful。</p>
<blockquote>
<div><p>我的理解是，像超文本一样携带一个地址，可以寻址定位信息，如超文本的link属性。</p>
</div></blockquote>
<div class="section" id="hypermedia-api">
<h2>超链接（Hypermedia）API<a class="headerlink" href="#hypermedia-api" title="Permalink to this headline">¶</a></h2>
<p>Hypermedia指的是，返回结果中提供链接，连向其他API方法，使得用户不查文档，也知道下一步应该做什么。比如，当用户向api.example.com的根目录发出请求，会得到这样一个文档：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;rel&quot;</span><span class="p">:</span>   <span class="s2">&quot;collection https://www.example.com/zoos&quot;</span><span class="p">,</span>
  <span class="s2">&quot;href&quot;</span><span class="p">:</span>  <span class="s2">&quot;https://api.example.com/zoos&quot;</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;List of zoos&quot;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span>  <span class="s2">&quot;application/vnd.yourformat+json&quot;</span>
<span class="p">}}</span>
</pre></div>
</div>
<p>上面代码表示，文档中有一个link属性，用户读取这个属性就知道下一步该调用什么API了。rel表示这个API与当前网址的关系（collection关系，并给出该collection的网址），href表示API的路径，title表示API的标题，type表示返回类型。</p>
<blockquote>
<div><p>摘取自：<a class="reference external" href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html">http://www.ruanyifeng.com/blog/2014/05/restful_api.html</a></p>
</div></blockquote>
</div>
<div class="section" id="api-rootendpoint">
<h2>创建api_root的Endpoint<a class="headerlink" href="#api-rootendpoint" title="Permalink to this headline">¶</a></h2>
<p>回到教程的例子。在前面我们已经为<code class="docutils literal notranslate"><span class="pre">snippets</span></code>和<code class="docutils literal notranslate"><span class="pre">users</span></code>创建了Endpoint，现在来创建根目录的Endpoint，编辑<code class="docutils literal notranslate"><span class="pre">snippets/views.py</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework.decorators</span> <span class="kn">import</span> <span class="n">api_view</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">rest_framework.reverse</span> <span class="kn">import</span> <span class="n">reverse</span>


<span class="nd">@api_view</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">api_root</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
        <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;user-list&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">),</span>
        <span class="s1">&#39;snippets&#39;</span><span class="p">:</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;snippet-list&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
    <span class="p">})</span>
</pre></div>
</div>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">reverse()</span></code>函数用来返回<code class="docutils literal notranslate"><span class="pre">snippets/urls.py</span></code>中viewname对应的url，如<code class="docutils literal notranslate"><span class="pre">path('users/',</span> <span class="pre">views.UserList.as_view(),</span> <span class="pre">name='user-list')</span></code>。</p>
</div></blockquote>
<p>然后添加到<code class="docutils literal notranslate"><span class="pre">snippets/urls.py</span></code>中：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">api_root</span><span class="p">),</span>
</pre></div>
</div>
</div>
<div class="section" id="snippethighlightendpoint">
<h2>创建SnippetHighlight的Endpoint<a class="headerlink" href="#snippethighlightendpoint" title="Permalink to this headline">¶</a></h2>
<p>还记得在上篇文章中提到的<code class="docutils literal notranslate"><span class="pre">Snippet.highlighted</span></code>字段么：</p>
<p><img alt="image2" src="../_images/image-20201220210707722.png" /></p>
<p>我们现在为它创建Endpoint，继续编辑<code class="docutils literal notranslate"><span class="pre">snippets/views.py</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">renderers</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">SnippetHighlight</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">GenericAPIView</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">renderer_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">renderers</span><span class="o">.</span><span class="n">StaticHTMLRenderer</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">snippet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">snippet</span><span class="o">.</span><span class="n">highlighted</span><span class="p">)</span>
</pre></div>
</div>
<p>然后添加到<code class="docutils literal notranslate"><span class="pre">snippets/urls.py</span></code>中：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;snippets/&lt;int:pk&gt;/highlight/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">SnippetHighlight</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</pre></div>
</div>
<blockquote>
<div><p>因为<code class="docutils literal notranslate"><span class="pre">snippet.highlighted</span></code>不是JSON而是HTML，所以用<code class="docutils literal notranslate"><span class="pre">[renderers.StaticHTMLRenderer]</span></code>返回预渲染的（pre-rendered）HTML。</p>
</div></blockquote>
</div>
<div class="section" id="hyperlinkedmodelserializer">
<h2>HyperlinkedModelSerializer<a class="headerlink" href="#hyperlinkedmodelserializer" title="Permalink to this headline">¶</a></h2>
<p>在Web API设计中，一般有以下几种方式来表示实体之间的关系：</p>
<ul class="simple">
<li><p>主键</p></li>
<li><p>超链接</p></li>
<li><p>关系实体（the related entity），唯一标识符字段（a unique identifying
slug field）</p></li>
<li><p>关系实体，默认字符串（the default string representation）</p></li>
<li><p>关系实体，嵌入到父类中（the parent representation）</p></li>
<li><p>其他自定义</p></li>
</ul>
<blockquote>
<div><p>前2个比较熟悉，后面几个有点不太懂，我理解是类似于数据库的关联关系表。</p>
</div></blockquote>
<p>DRF支持以上所有方式，这里我们用DRF的<code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code>来实现真正的RESTful。在<code class="docutils literal notranslate"><span class="pre">snippets/serializers.py</span></code>中把我们之前的代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SnippetSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ReadOnlyField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;owner.username&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Snippet</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;linenos&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">snippets</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">PrimaryKeyRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;snippets&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>修改为：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SnippetSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ReadOnlyField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;owner.username&#39;</span><span class="p">)</span>
    <span class="n">highlight</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedIdentityField</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="s1">&#39;snippet-highlight&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Snippet</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;linenos&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="n">snippets</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="s1">&#39;snippet-detail&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;snippets&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>其中<code class="docutils literal notranslate"><span class="pre">ModelSerializer</span></code>换成了<code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code>，后者的区别如下：</p>
<ul>
<li><p>默认不包含<code class="docutils literal notranslate"><span class="pre">id</span></code>字段</p></li>
<li><p>包含<code class="docutils literal notranslate"><span class="pre">url</span></code>字段，用<code class="docutils literal notranslate"><span class="pre">HyperlinkedIdentityField</span></code>表示</p>
<blockquote>
<div><p>源码：<code class="docutils literal notranslate"><span class="pre">serializer_url_field</span> <span class="pre">=</span> <span class="pre">HyperlinkedIdentityField</span></code></p>
</div></blockquote>
</li>
<li><p>关系用<code class="docutils literal notranslate"><span class="pre">HyperlinkedRelatedField</span></code>表示，而不是<code class="docutils literal notranslate"><span class="pre">PrimaryKeyRelatedField</span></code></p>
<blockquote>
<div><p>源码：<code class="docutils literal notranslate"><span class="pre">serializer_related_field</span> <span class="pre">=</span> <span class="pre">HyperlinkedRelatedField</span></code></p>
</div></blockquote>
</li>
</ul>
<p>由于用了HyperlinkedModelSerializer，SnippetSerializer和UserSerializer的url字段默认指向的是<code class="docutils literal notranslate"><span class="pre">'{model_name}-detail'</span></code>
url pattern，这是DRF定义的，在示例中就是<code class="docutils literal notranslate"><span class="pre">'snippet-detail'</span></code>
和<code class="docutils literal notranslate"><span class="pre">'user-detail'</span></code>。新增的<code class="docutils literal notranslate"><span class="pre">highlight</span></code>字段和<code class="docutils literal notranslate"><span class="pre">url</span></code>字段是一样的类型，它指向的是<code class="docutils literal notranslate"><span class="pre">'snippet-highlight'</span></code>，而不是<code class="docutils literal notranslate"><span class="pre">'snippet-detail'</span></code>。</p>
</div>
<div class="section" id="url-pattern">
<h2>修改url pattern<a class="headerlink" href="#url-pattern" title="Permalink to this headline">¶</a></h2>
<p>既然已经提到了url pattern，那么在<code class="docutils literal notranslate"><span class="pre">snippets/urls.py</span></code>中修改一下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">rest_framework.urlpatterns</span> <span class="kn">import</span> <span class="n">format_suffix_patterns</span>

<span class="kn">from</span> <span class="nn">snippets</span> <span class="kn">import</span> <span class="n">views</span>

<span class="c1">## API endpoints</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">format_suffix_patterns</span><span class="p">([</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">api_root</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;snippets/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">SnippetList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;snippet-list&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;snippets/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">SnippetDetail</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;snippet-detail&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;snippets/&lt;int:pk&gt;/highlight/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">SnippetHighlight</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;snippet-highlight&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;users/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;user-list&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;users/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserDetail</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;user-detail&#39;</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
<blockquote>
<div><p>name就是在<code class="docutils literal notranslate"><span class="pre">serializers.py</span></code>和<code class="docutils literal notranslate"><span class="pre">views.py</span></code>中用到的。</p>
</div></blockquote>
</div>
<div class="section" id="id1">
<h2>添加分页<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>REST设计基本原则提到了：处理好分页。DRF添加分页的方式很简单，编辑<code class="docutils literal notranslate"><span class="pre">tutorial/settings.py</span></code>文件：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_PAGINATION_CLASS&#39;</span><span class="p">:</span> <span class="s1">&#39;rest_framework.pagination.PageNumberPagination&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PAGE_SIZE&#39;</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>小结<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>我之前是在学SpringBoot的时候了解过RESTful
API的超链接API，文章开头的那一段介绍就是当时写的笔记，DRF提供了<code class="docutils literal notranslate"><span class="pre">HyperlinkedModelSerializer</span></code>来实现，还是比较好理解的，其中的细节需要在实战中再多多熟悉。</p>
<blockquote>
<div><p>参考资料：</p>
<p><a class="reference external" href="https://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/">https://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/</a></p>
<p><a class="reference external" href="https://spring.io/guides/tutorials/rest/">https://spring.io/guides/tutorials/rest/</a></p>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="007-DRF%E7%BB%88%E6%9E%81%E5%B0%81%E8%A3%85ViewSet%E5%92%8CRouter%E9%99%84%E6%95%99%E7%A8%8BPDF%E6%BA%90%E7%A0%81.html" class="btn btn-neutral float-right" title="7 DRF终极封装ViewSet和Router附教程PDF源码" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="005-DRF%E6%AF%94Django%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%9D%83%E9%99%90%E9%AB%98%E5%9C%A8%E5%93%AA%E9%87%8C.html" class="btn btn-neutral float-left" title="5 DRF比Django的认证和权限高在哪里" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright dongfanger

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>