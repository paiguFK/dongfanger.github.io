

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2 揭开DRF序列化技术的神秘面纱 &mdash; 自动化代码美学 latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/readmore.js"></script>
        <script src="../_static/js/baidutongji.js"></script>
        <script src="../_static/js/valine.js"></script>
        <script src="../_static/js/Valine.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3 DRF对Django请求响应做了技术升级" href="003-DRF%E5%AF%B9Django%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%81%9A%E4%BA%86%E6%8A%80%E6%9C%AF%E5%8D%87%E7%BA%A7.html" />
    <link rel="prev" title="1 快用DjangoRESTframework写写API吧" href="001-%E5%BF%AB%E7%94%A8DjangoRESTframework%E5%86%99%E5%86%99API%E5%90%A7.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> 自动化代码美学
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preface.html">前言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Python%E5%85%A5%E9%97%A8.html">Python入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Python%E8%BF%9B%E9%98%B6.html">Python进阶</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/pytest%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6.html">pytest原生框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/tep%E5%BC%80%E6%BA%90%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7.html">tep开源测试工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/teprunner%E5%BC%80%E6%BA%90%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0.html">teprunner开源测试平台</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Django.html">Django</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../chapters/Django%20REST%20framework.html">Django REST framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="001-%E5%BF%AB%E7%94%A8DjangoRESTframework%E5%86%99%E5%86%99API%E5%90%A7.html">1 快用DjangoRESTframework写写API吧</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2 揭开DRF序列化技术的神秘面纱</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">创建虚拟环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">创建项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model">创建model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serializer">创建Serializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">玩玩Serializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modelserializers">使用ModelSerializers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#views">编写views</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api">测试API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">小结</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="003-DRF%E5%AF%B9Django%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%81%9A%E4%BA%86%E6%8A%80%E6%9C%AF%E5%8D%87%E7%BA%A7.html">3 DRF对Django请求响应做了技术升级</a></li>
<li class="toctree-l2"><a class="reference internal" href="004-DRF%E7%B1%BB%E8%A7%86%E5%9B%BE%E8%AE%A9%E4%BD%A0%E7%9A%84%E4%BB%A3%E7%A0%81DRY%E8%B5%B7%E6%9D%A5.html">4 DRF类视图让你的代码DRY起来</a></li>
<li class="toctree-l2"><a class="reference internal" href="005-DRF%E6%AF%94Django%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%9D%83%E9%99%90%E9%AB%98%E5%9C%A8%E5%93%AA%E9%87%8C.html">5 DRF比Django的认证和权限高在哪里</a></li>
<li class="toctree-l2"><a class="reference internal" href="006-DRF%E4%BD%BF%E7%94%A8%E8%B6%85%E9%93%BE%E6%8E%A5API%E5%AE%9E%E7%8E%B0%E7%9C%9F%E6%AD%A3RESTful.html">6 DRF使用超链接API实现真正RESTful</a></li>
<li class="toctree-l2"><a class="reference internal" href="007-DRF%E7%BB%88%E6%9E%81%E5%B0%81%E8%A3%85ViewSet%E5%92%8CRouter%E9%99%84%E6%95%99%E7%A8%8BPDF%E6%BA%90%E7%A0%81.html">7 DRF终极封装ViewSet和Router附教程PDF源码</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Locust.html">Locust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/Java%E5%85%A5%E9%97%A8.html">Java入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/JMeter.html">JMeter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/%E5%A4%A7%E6%9D%82%E7%83%A9.html">大杂烩</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/%E9%9D%A2%E8%AF%95%E9%A2%98.html">面试题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B.html">视频教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93.html">年度总结</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/%E6%88%90%E9%95%BF%E5%B0%8F%E8%AF%B4.html">成长小说</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">联系方式</a></li>
<li class="toctree-l1"><a class="reference internal" href="../link.html">友情链接</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">自动化代码美学</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../chapters/Django%20REST%20framework.html">Django REST framework</a> &raquo;</li>
        
      <li>2 揭开DRF序列化技术的神秘面纱</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Django REST framework/002-揭开DRF序列化技术的神秘面纱.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="drf">
<h1>2 揭开DRF序列化技术的神秘面纱<a class="headerlink" href="#drf" title="Permalink to this headline">¶</a></h1>
<p><img alt="image1" src="../_images/wanggang.png" /></p>
<p>在RESTful
API中，接口返回的是JSON，JSON的内容对应的是数据库中的数据，DRF是通过序列化（Serialization）的技术，把数据模型转换为JSON的，反之，叫做反序列化（deserialization）。本文就来揭开2揭开DRF序列化技术的神秘面纱技术的神秘面纱。</p>
<div class="section" id="id1">
<h2>创建虚拟环境<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>虚拟环境是独立的Python环境，可以和系统环境分离，只安装需要的包即可，使用以下命令创建并激活：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 创建Python虚拟环境</span>
python -m venv env
<span class="c1"># 激活虚拟环境</span>
env<span class="se">\S</span>cripts<span class="se">\a</span>ctivate.bat
<span class="c1"># Mac中使用`source env/bin/activate`</span>
</pre></div>
</div>
<blockquote>
<div><p>退出虚拟环境用deactivate。</p>
</div></blockquote>
<p>接着在虚拟环境中安装本文用到的包：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">django</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">djangorestframework</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pygments</span>  <span class="c1"># 代码高亮</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>创建项目<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>创建project：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>django-admin startproject tutorial
</pre></div>
</div>
<p>创建app：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> tutorial
python manage.py startapp snippets
</pre></div>
</div>
<p>在<code class="docutils literal notranslate"><span class="pre">tutorial/settings.py</span></code>中的<code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code>添加<code class="docutils literal notranslate"><span class="pre">snippets</span></code>和<code class="docutils literal notranslate"><span class="pre">rest_framework</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="s1">&#39;snippets.apps.SnippetsConfig&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<blockquote>
<div><p>只有添加后，app才会生效哦。</p>
</div></blockquote>
</div>
<div class="section" id="model">
<h2>创建model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h2>
<p>编辑<code class="docutils literal notranslate"><span class="pre">snippets/models.py</span></code>，创建Snippet模型：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">pygments.lexers</span> <span class="kn">import</span> <span class="n">get_all_lexers</span>
<span class="kn">from</span> <span class="nn">pygments.styles</span> <span class="kn">import</span> <span class="n">get_all_styles</span>

<span class="n">LEXERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">get_all_lexers</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">LANGUAGE_CHOICES</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">LEXERS</span><span class="p">])</span>
<span class="n">STYLE_CHOICES</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">item</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">get_all_styles</span><span class="p">()])</span>


<span class="k">class</span> <span class="nc">Snippet</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">linenos</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">LANGUAGE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">STYLE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;friendly&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Snippet有6个字段，created、title、code、linenos、language、style。</p>
<p>接着同步数据库：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span> <span class="n">snippets</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
</pre></div>
</div>
</div>
<div class="section" id="serializer">
<h2>创建Serializer<a class="headerlink" href="#serializer" title="Permalink to this headline">¶</a></h2>
<p>rest_framework.serializers的结构如下：</p>
<p><img alt="image2" src="../_images/image-20201216135851023.png" /></p>
<blockquote>
<div><p>查看Python模块中的成员，需要勾选：</p>
<p><img alt="image3" src="../_images/image-20201216141009513.png" /></p>
</div></blockquote>
<p>之前我们用过HyperlinkedModelSerializer，是封装后的符合RESTful良好设计的序列化器，这里直接使用更底层的Serializer。在<code class="docutils literal notranslate"><span class="pre">snippets</span></code>目录下创建<code class="docutils literal notranslate"><span class="pre">serializers.py</span></code>，添加以下代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">snippets.models</span> <span class="kn">import</span> <span class="n">Snippet</span><span class="p">,</span> <span class="n">LANGUAGE_CHOICES</span><span class="p">,</span> <span class="n">STYLE_CHOICES</span>


<span class="k">class</span> <span class="nc">SnippetSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;base_template&#39;</span><span class="p">:</span> <span class="s1">&#39;textarea.html&#39;</span><span class="p">})</span>
    <span class="n">linenos</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">LANGUAGE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">STYLE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;friendly&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and return a new `Snippet` instance, given the validated data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update and return an existing `Snippet` instance, given the validated data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">linenos</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linenos&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">linenos</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">style</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">instance</span>
</pre></div>
</div>
<p>代码第一部分定义了序列化/反序列化的字段，字段定义方式类似于Form。第二部分的<code class="docutils literal notranslate"><span class="pre">create()</span></code>和<code class="docutils literal notranslate"><span class="pre">update()</span></code>方法定义了调用<code class="docutils literal notranslate"><span class="pre">serializer.save()</span></code>时，创建和更新实例的处理方式。</p>
</div>
<div class="section" id="id3">
<h2>玩玩Serializer<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>既然已经创建好了Serializer，何不玩玩它？只有玩了才知道序列化的技术细节。这里用到了Django
shell，可以在命令行实时看到输出结果：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python manage.py shell
</pre></div>
</div>
<p>首先通过模型新增2条测试数据：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">snippets.models</span> <span class="kn">import</span> <span class="n">Snippet</span>
<span class="kn">from</span> <span class="nn">snippets.serializers</span> <span class="kn">import</span> <span class="n">SnippetSerializer</span>
<span class="kn">from</span> <span class="nn">rest_framework.renderers</span> <span class="kn">import</span> <span class="n">JSONRenderer</span>
<span class="kn">from</span> <span class="nn">rest_framework.parsers</span> <span class="kn">import</span> <span class="n">JSONParser</span>

<span class="n">snippet</span> <span class="o">=</span> <span class="n">Snippet</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s1">&#39;foo = &quot;bar&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">snippet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">snippet</span> <span class="o">=</span> <span class="n">Snippet</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s1">&#39;print(&quot;hello, world&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">snippet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="image4" src="../_images/image-20201216144156942.png" /></p>
<p>接着把它序列化看看：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># {&#39;id&#39;: 2, &#39;title&#39;: &#39;&#39;, &#39;code&#39;: &#39;print(&quot;hello, world&quot;)\n&#39;, &#39;linenos&#39;: False, &#39;language&#39;: &#39;python&#39;, &#39;style&#39;: &#39;friendly&#39;}</span>
</pre></div>
</div>
<blockquote>
<div><p>因为<code class="docutils literal notranslate"><span class="pre">snippet</span></code>变量最后引用的是第2个数据模型的实例，所以这里只显示第2条数据。</p>
</div></blockquote>
<p>serializer.data返回的是个字典，最后把字典转换为JSON：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">content</span> <span class="o">=</span> <span class="n">JSONRenderer</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">content</span>
<span class="c1"># b&#39;{&quot;id&quot;: 2, &quot;title&quot;: &quot;&quot;, &quot;code&quot;: &quot;print(\\&quot;hello, world\\&quot;)\\n&quot;, &quot;linenos&quot;: false, &quot;language&quot;: &quot;python&quot;, &quot;style&quot;: &quot;friendly&quot;}&#39;</span>
</pre></div>
</div>
<p>这就是序列化的过程，模型实例→Python字典→JSON。</p>
<p>反序列化的过程是类似的，先把JSON转换为Python字典：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</pre></div>
</div>
<p>再把字典转换为模型实例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="c1"># True</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">validated_data</span>
<span class="c1"># OrderedDict([(&#39;title&#39;, &#39;&#39;), (&#39;code&#39;, &#39;print(&quot;hello, world&quot;)\n&#39;), (&#39;linenos&#39;, False), (&#39;language&#39;, &#39;python&#39;), (&#39;style&#39;, &#39;friendly&#39;)])</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="c1"># &lt;Snippet: Snippet object&gt;</span>
</pre></div>
</div>
<blockquote>
<div><p>因为SnippetSerializer的create()方法代码是<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">Snippet.objects.create(**validated_data)</span></code>，所以<code class="docutils literal notranslate"><span class="pre">serializer.save()</span></code>会在数据库中新增1条数据，并返回Snippet模型实例。</p>
</div></blockquote>
<p>另外，序列化对象不只有模型实例，也可以是数据集：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># [OrderedDict([(&#39;id&#39;, 1), (&#39;title&#39;, &#39;&#39;), (&#39;code&#39;, &#39;foo = &quot;bar&quot;\n&#39;), (&#39;linenos&#39;, False), (&#39;language&#39;, &#39;python&#39;), (&#39;style&#39;, &#39;friendly&#39;)]), OrderedDict([(&#39;id&#39;, 2), (&#39;title&#39;, &#39;&#39;), (&#39;code&#39;, &#39;print(&quot;hello, world&quot;)\n&#39;), (&#39;linenos&#39;, False), (&#39;language&#39;, &#39;python&#39;), (&#39;style&#39;, &#39;friendly&#39;)]), OrderedDict([(&#39;id&#39;, 3), (&#39;title&#39;, &#39;&#39;), (&#39;code&#39;, &#39;print(&quot;hello, world&quot;)&#39;), (&#39;linenos&#39;, False), (&#39;language&#39;, &#39;python&#39;), (&#39;style&#39;, &#39;friendly&#39;)])]</span>
</pre></div>
</div>
</div>
<div class="section" id="modelserializers">
<h2>使用ModelSerializers<a class="headerlink" href="#modelserializers" title="Permalink to this headline">¶</a></h2>
<p>rest_framework.serializers.Serializers比较底层，需要重复定义model中的字段，DRF的作者当然也想到了这个问题，并且给出了解决办法：把Serializers封装成ModelSerializers。在<code class="docutils literal notranslate"><span class="pre">snippets/serializers.py</span></code>中替换<code class="docutils literal notranslate"><span class="pre">SnippetSerializer</span></code>为：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SnippetSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Snippet</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;linenos&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>写法果然简洁了很多。使用Django shell打印出来看看：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">snippets.serializers</span> <span class="kn">import</span> <span class="n">SnippetSerializer</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">serializer</span><span class="p">))</span>
<span class="c1"># SnippetSerializer():</span>
<span class="c1">#    id = IntegerField(label=&#39;ID&#39;, read_only=True)</span>
<span class="c1">#    title = CharField(allow_blank=True, max_length=100, required=False)</span>
<span class="c1">#    code = CharField(style={&#39;base_template&#39;: &#39;textarea.html&#39;})</span>
<span class="c1">#    linenos = BooleanField(required=False)</span>
<span class="c1">#    language = ChoiceField(choices=[(&#39;Clipper&#39;, &#39;FoxPro&#39;), (&#39;Cucumber&#39;, &#39;Gherkin&#39;), (&#39;RobotFramework&#39;, &#39;RobotFramework&#39;), (&#39;abap&#39;, &#39;ABAP&#39;), (&#39;ada&#39;, &#39;Ada&#39;)...</span>
<span class="c1">#    style = ChoiceField(choices=[(&#39;autumn&#39;, &#39;autumn&#39;), (&#39;borland&#39;, &#39;borland&#39;), (&#39;bw&#39;, &#39;bw&#39;), (&#39;colorful&#39;, &#39;colorful&#39;)...</span>
</pre></div>
</div>
<p>和手动定义的字段一模一样。其实ModelSerializer并没有做额外的处理，我们可以从它的部分代码片段看到:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer_field_mapping</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">:</span> <span class="n">IntegerField</span><span class="p">,</span>
      <span class="n">models</span><span class="o">.</span><span class="n">BigIntegerField</span><span class="p">:</span> <span class="n">IntegerField</span><span class="p">,</span>
      <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">:</span> <span class="n">BooleanField</span><span class="p">,</span>


<span class="c1"># Default `create` and `update` behavior...</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>


<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
    <span class="n">raise_errors_on_nested_writes</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">)</span>
</pre></div>
</div>
<p>建立字段映射，定义<code class="docutils literal notranslate"><span class="pre">create()</span></code>和<code class="docutils literal notranslate"><span class="pre">update()</span></code>等方法，只做了最简单的封装。</p>
</div>
<div class="section" id="views">
<h2>编写views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p>我们之前用的是已经封装好的rest_framework.viewsets，这里直接用Django原生的view。在<code class="docutils literal notranslate"><span class="pre">snippets/views.py</span></code>中添加代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="kn">from</span> <span class="nn">rest_framework.parsers</span> <span class="kn">import</span> <span class="n">JSONParser</span>
<span class="kn">from</span> <span class="nn">snippets.models</span> <span class="kn">import</span> <span class="n">Snippet</span>
<span class="kn">from</span> <span class="nn">snippets.serializers</span> <span class="kn">import</span> <span class="n">SnippetSerializer</span>
</pre></div>
</div>
<p>先创建snippet_list视图，返回snippets列表或者新建1个snippet：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">snippet_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List all code snippets, or create a new snippet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">snippets</span> <span class="o">=</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">snippets</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
<p>本文示例中，客户端发起POST请求是不带CSRF
token的，所以需要添加csrf_exempt（exempt翻译为免除）装饰器，允许跨域访问。这里只是演示，实际会使用<code class="docutils literal notranslate"><span class="pre">django-cors-headers</span></code>来解决跨域问题，而不是给每个view都加上<code class="docutils literal notranslate"><span class="pre">&#64;csrf_exempt</span></code>。</p>
<blockquote>
<div><p>CSRF是指跨站请求伪造，攻击者盗用你的身份，以你的名义发送恶意请求。CSRF
token是指服务器通过token来认证，如果请求中没有token或者token不匹配，那么就认为可能是CSRF而拒绝该请求。</p>
</div></blockquote>
<p>接着添加一个view，对单个snippet进行删（delete）、改（update）、查（retrieve）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">snippet_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve, update or delete a code snippet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">snippet</span> <span class="o">=</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;PUT&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">snippet</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">:</span>
        <span class="n">snippet</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">204</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>注意，前面create返回的status为201，这里retrieve返回的默认的200，附上几个常见状态码：</p>
<ul class="simple">
<li><p>200 OK -
GET/PUT/PATCH：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）</p></li>
<li><p>201 CREATED - POST：用户新建数据成功</p></li>
<li><p>204 NO content - DELETE：用户删除数据成功</p></li>
<li><p>400 Invalid request -
POST/PUT/PATCH：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的</p></li>
<li><p>401 Unauthorized - *：表示用户没有权限（令牌、用户名、密码错误）</p></li>
<li><p>403 Forbidden -
*：表示用户得到授权（与401错误相对），但是访问是被禁止的</p></li>
</ul>
</div></blockquote>
<p>最后，添加路由，新建文件<code class="docutils literal notranslate"><span class="pre">snippets/urls.py</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">snippets</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;snippets/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">snippet_list</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;snippets/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">snippet_detail</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>再配置到<code class="docutils literal notranslate"><span class="pre">tutorial/urls.py</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;snippets.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="api">
<h2>测试API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>启动项目：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python manage.py runserver
</pre></div>
</div>
<p>新开一个Terminal，安装HTTP命令行工具：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install httpie
</pre></div>
</div>
<p>请求snippets列表：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>http http://127.0.0.1:8000/snippets/

HTTP/1.1 <span class="m">200</span> OK
...
<span class="o">[</span>
  <span class="o">{</span>
    <span class="s2">&quot;id&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;&quot;</span>,
    <span class="s2">&quot;code&quot;</span>: <span class="s2">&quot;foo = \&quot;bar\&quot;\n&quot;</span>,
    <span class="s2">&quot;linenos&quot;</span>: false,
    <span class="s2">&quot;language&quot;</span>: <span class="s2">&quot;python&quot;</span>,
    <span class="s2">&quot;style&quot;</span>: <span class="s2">&quot;friendly&quot;</span>
  <span class="o">}</span>,
  <span class="o">{</span>
    <span class="s2">&quot;id&quot;</span>: <span class="m">2</span>,
    <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;&quot;</span>,
    <span class="s2">&quot;code&quot;</span>: <span class="s2">&quot;print(\&quot;hello, world\&quot;)\n&quot;</span>,
    <span class="s2">&quot;linenos&quot;</span>: false,
    <span class="s2">&quot;language&quot;</span>: <span class="s2">&quot;python&quot;</span>,
    <span class="s2">&quot;style&quot;</span>: <span class="s2">&quot;friendly&quot;</span>
  <span class="o">}</span>
<span class="o">]</span>
</pre></div>
</div>
<p>请求id为2的snippet：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>http http://127.0.0.1:8000/snippets/2/

HTTP/1.1 <span class="m">200</span> OK
...
<span class="o">{</span>
  <span class="s2">&quot;id&quot;</span>: <span class="m">2</span>,
  <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;&quot;</span>,
  <span class="s2">&quot;code&quot;</span>: <span class="s2">&quot;print(\&quot;hello, world\&quot;)\n&quot;</span>,
  <span class="s2">&quot;linenos&quot;</span>: false,
  <span class="s2">&quot;language&quot;</span>: <span class="s2">&quot;python&quot;</span>,
  <span class="s2">&quot;style&quot;</span>: <span class="s2">&quot;friendly&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>小结<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>不得不说DRF的Tutorial实践性很强，基本上照着做都能敲出来，体验比较好。序列化的过程，就是模型实例→Python字典→JSON的过程。通过本文也理解了在app中<code class="docutils literal notranslate"><span class="pre">models.py</span></code>→<code class="docutils literal notranslate"><span class="pre">serializers.py</span></code>→<code class="docutils literal notranslate"><span class="pre">views.py</span></code>→<code class="docutils literal notranslate"><span class="pre">urls.py</span></code>的代码编写顺序。</p>
<blockquote>
<div><p>参考资料：</p>
<p><a class="reference external" href="https://www.django-rest-framework.org/tutorial/1-serialization/">https://www.django-rest-framework.org/tutorial/1-serialization/</a></p>
<p><a class="reference external" href="https://blog.csdn.net/yexudengzhidao/article/details/93527586">https://blog.csdn.net/yexudengzhidao/article/details/93527586</a></p>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="003-DRF%E5%AF%B9Django%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E5%81%9A%E4%BA%86%E6%8A%80%E6%9C%AF%E5%8D%87%E7%BA%A7.html" class="btn btn-neutral float-right" title="3 DRF对Django请求响应做了技术升级" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="001-%E5%BF%AB%E7%94%A8DjangoRESTframework%E5%86%99%E5%86%99API%E5%90%A7.html" class="btn btn-neutral float-left" title="1 快用DjangoRESTframework写写API吧" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright dongfanger

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>